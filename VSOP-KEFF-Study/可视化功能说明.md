# VSOP KEFF 研究脚本可视化功能说明

## 概述

本脚本现在支持完整的可视化功能，可以在运行过程中实时监控研究进度和结果，并在完成后生成详细的分析图表。

## 功能特点

### 1. 实时监控界面

运行过程中会显示一个实时监控窗口，包含：

- **进度条**：显示当前计算进度和状态
- **KEFF值变化图**：实时显示KEFF值随参数变化的趋势
- **参数关系图**：验证双参数的比例关系（7.95:5）
- **统计信息**：实时显示当前结果统计

### 2. 最终分析图表

计算完成后会生成一个6子图的综合分析图表：

1. **KEFF vs 第87行参数值**：主参数与KEFF值的关系
2. **KEFF vs 第92行参数值**：从参数与KEFF值的关系
3. **参数关系验证**：验证双参数的比例关系
4. **KEFF变化率**：显示KEFF值的变化率
5. **KEFF值分布直方图**：显示KEFF值的分布情况
6. **统计信息表格**：详细的统计信息

### 3. 兼容性设计

- **自动检测**：自动检测matplotlib是否安装
- **降级处理**：如果没有matplotlib，使用文本进度条
- **用户选择**：即使有matplotlib，用户也可以选择禁用可视化

## 安装依赖

要使用可视化功能，需要安装matplotlib：

```bash
pip install matplotlib
```

或者安装全部依赖：

```bash
pip install -r requirements.txt
```

## 使用方法

### 启用可视化（推荐）

1. 运行脚本：`python keff_study_simple.py`
2. 当询问是否启用可视化时，选择 `y`（默认）
3. 设置参数后开始运行
4. 观察实时监控窗口
5. 完成后查看最终分析图表

### 禁用可视化

1. 运行脚本：`python keff_study_simple.py`
2. 当询问是否启用可视化时，选择 `n`
3. 脚本将以纯文本模式运行，显示文本进度条

## 输出文件

### 可视化模式下的输出

- `keff_study_results.csv`：详细的计算结果
- `keff_study_summary.txt`：统计摘要
- `keff_study_analysis.png`：高分辨率分析图表（300 DPI）

### 纯文本模式下的输出

- `keff_study_results.csv`：详细的计算结果
- `keff_study_summary.txt`：统计摘要

## 可视化界面说明

### 实时监控窗口

```
┌─────────────────────────────────────────────────────────────┐
│                    VSOP KEFF 研究实时监控                      │
├─────────────────────────────────────────────────────────────┤
│                        运行进度                              │
│     ████████████████████████████████████████████████        │
│                      3/9 (33.3%)                           │
├─────────────────────────┬───────────────────────────────────┤
│     KEFF值变化          │      双参数关系 (7.95:5)          │
│                        │                                   │
│  ●──●──●──●──●         │      ●──●──●──●──●                │
│                        │                                   │
├─────────────────────────────────────────────────────────────┤
│                     实时统计信息                             │
│  当前结果数: 3                                               │
│  KEFF值范围: 1.234567 - 1.234890                           │
│  最大变化: 0.0234%                                          │
└─────────────────────────────────────────────────────────────┘
```

### 最终分析图表

```
┌─────────────────────────────────────────────────────────────┐
│                   VSOP KEFF 研究结果分析                      │
├─────────────────┬─────────────────┬─────────────────────────┤
│  KEFF vs 第87行  │  KEFF vs 第92行  │     参数关系验证         │
│   参数值        │   参数值        │                         │
├─────────────────┼─────────────────┼─────────────────────────┤
│   KEFF变化率    │   KEFF值分布    │     统计信息表格         │
│               │               │                         │
└─────────────────┴─────────────────┴─────────────────────────┘
```

## 技术特点

### 实时更新机制

- 使用matplotlib的交互模式（`plt.ion()`）
- 每完成一个计算点立即更新图表
- 非阻塞式更新，不影响计算进程

### 数据处理

- 自动排序数据以获得最佳图表效果
- 对数坐标轴适应宽范围的参数值
- 智能标签避免重叠

### 图表优化

- 高分辨率输出（300 DPI）
- 专业的科学图表风格
- 中文字体支持
- 色彩搭配优化

## 常见问题

### Q: 图表窗口没有显示？

A: 请检查：
1. 是否正确安装了matplotlib
2. 是否有图形界面（远程服务器可能没有）
3. 是否被杀毒软件拦截

### Q: 图表更新很慢？

A: 这是正常现象，因为：
1. 每次更新都需要重绘图表
2. 实时更新优先保证数据准确性
3. 可以选择禁用可视化以提高速度

### Q: 如何保存中间结果？

A: 脚本会自动保存：
1. 每个计算点的.out文件
2. 最终的CSV和TXT结果文件
3. 高分辨率的PNG图表文件

## 性能建议

### 推荐配置

- **内存**：至少4GB RAM
- **显示器**：分辨率至少1920x1080
- **Python**：Python 3.7+
- **matplotlib**：3.3.0+

### 性能优化

1. **小批量测试**：先用少量点数测试
2. **关闭其他程序**：确保足够的内存
3. **使用SSD**：提高文件I/O速度
4. **禁用实时更新**：如果不需要监控可以禁用可视化

## 扩展功能

### 自定义图表样式

可以修改脚本中的图表参数：

```python
# 修改图表尺寸
self.fig = plt.figure(figsize=(15, 10))

# 修改颜色
ax.plot(x, y, 'bo-', linewidth=2, markersize=6)

# 修改网格
ax.grid(True, alpha=0.3)
```

### 添加新的分析图表

在 `generate_final_plots()` 函数中添加新的子图：

```python
# 添加新的子图
ax_new = fig_final.add_subplot(2, 4, 7)  # 2行4列第7个位置
ax_new.plot(data_x, data_y)
ax_new.set_title('新的分析图表')
```

## 支持与反馈

如果在使用过程中遇到问题，请：

1. 检查依赖是否正确安装
2. 查看控制台的错误信息
3. 确认输入文件格式正确
4. 检查磁盘空间是否充足

---

*更新日期：2025年1月* 